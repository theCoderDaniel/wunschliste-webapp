<!DOCTYPE html>
<html lang="de">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Wunschliste</title>
  <style>
    :root{
      --bg:#fff;
      --fg:#111;
      --muted:#6b6b6b;
      --chip:#f5f5f5;
      --hover:#f0f0f0;
      --radius:12px;
      --s1:8px; --s2:12px; --s3:16px; --s4:24px; --s5:32px;

      /* Einheitliche Spalten für Kopfzeile, Items, Summary */
      --price-col: 140px;      /* Breite der Preis-Spalte */
      --action-col: 100px;     /* Fixe Breite für „Aktion“ (passt für „Entfernen“) */
      --cols: minmax(0,1fr) var(--price-col) var(--action-col);
      --pad-x: 14px;           /* horizontales Padding */
      --gap-x: 12px;           /* Spaltengap */
    }

    *{ box-sizing:border-box; }
    html, body{ margin:0; padding:0; background:var(--bg); color:var(--fg); font:16px/1.5 system-ui,-apple-system,Segoe UI,Roboto,Helvetica,Arial,sans-serif; }
    .container{ max-width:760px; margin:0 auto; padding:var(--s4) var(--s3) var(--s5); }
    h1{ font-size:1.9rem; line-height:1.25; margin:0 0 var(--s4); letter-spacing:.2px; }

    .section-title{
      margin:0 0 var(--s2);
      font-size:.9rem; font-weight:700; letter-spacing:.04em; text-transform:uppercase; color:var(--muted);
    }

    /* Formular */
    form{
      display:grid; grid-template-columns: 2fr 1fr 2fr auto; gap:var(--s3); align-items:end;
      margin-bottom:var(--s4);
    }
    .field label{ font-size:.8rem; color:var(--muted); display:block; margin:0 0 6px; }
    input[type="text"], input[type="url"]{
      width:100%; padding:12px 14px; border:none; background:var(--chip); color:var(--fg);
      border-radius:var(--radius);
    }
    input::placeholder{ color:#9a9a9a; }
    input:focus-visible{ outline:3px solid #000; outline-offset:2px; background:#fff; }

    /* Buttons */
    .btn{ cursor:pointer; font:inherit; }
    .btn-primary{
      padding:12px 16px; border:1px solid #000; background:#000; color:#fff; border-radius:var(--radius);
      transition:background .12s ease;
    }
    .btn-primary:hover{ background:#111; }
    .btn-link{
      padding:6px 2px; border:none; background:none; color:#111;
      text-decoration:underline; text-underline-offset:3px;
    }
    .btn-link:hover{ text-decoration:none; }
    .btn-link:focus-visible{ outline:3px solid #000; outline-offset:2px; border-radius:6px; }

    /* Toolbar */
    .toolbar{
      display:flex; gap:18px; flex-wrap:wrap; justify-content:flex-end;
      margin: -6px 0 var(--s4);
    }

    /* Kopfzeile & Items – identische Grid-Definition */
    .list-head, .item{
      display: grid;
      grid-template-columns: var(--cols);
      gap: var(--gap-x);
      align-items: center;
      padding: 10px var(--pad-x);
      border-radius: 10px;
    }

    .list-head{
      font-size:.8rem; color:var(--muted);
      background:var(--chip); margin-bottom:10px;
    }

    /* Liste */
    ul{ list-style:none; margin:0; padding:0; display:flex; flex-direction:column; gap:10px; }

    .item{
      background:#fafafa;
      transition:background .12s ease, transform .12s ease;
    }
    .item:hover{ background:var(--hover); }

    .name{ min-width:0; display:flex; align-items:center; gap:10px; }
    .name a{ color:var(--fg); text-decoration:none; }
    .name a:hover{ text-decoration:underline; text-underline-offset:3px; }

    .list-head .price, .item .price{ text-align:right; }
    .list-head .actions, .row-actions{ text-align:right; }

    .price{ font-variant-numeric: tabular-nums; } /* saubere Ziffernausrichtung */
    .empty{ color:var(--muted); padding:var(--s2) 0; }

    /* Summary – gleiche Spalten wie Liste */
    .summary{
      display:grid; grid-template-columns: var(--cols);
      gap: var(--gap-x);
      align-items:center;
      padding:12px var(--pad-x);
      margin-top:var(--s4);
      background:var(--chip);
      border-radius:12px;
      font-weight:700;
    }
    .summary .price{ grid-column:2; text-align:right; }

    /* Responsive */
    @media (max-width: 780px){
      form{ grid-template-columns: 1fr; }
      .toolbar{ justify-content:flex-start; }
      .list-head{ display:none; }
      .item{ grid-template-columns: 1fr auto; }
      .summary{ grid-template-columns: 1fr auto; }
      .price{ order:2; }
      .row-actions{ order:3; }
      .summary .price{ grid-column:2; }
    }

    /* 1) Etwas geringerer Kontrast der Kartenflächen */
    .item { background: #f7f7f7; }
    .item:hover { background: #efefef; }
    .list-head, .summary { background: #f7f7f7; }

    /* 2) Einheitlich etwas geringerer Radius (straffer Look) */
    :root { --radius: 10px; }

    /* 3) Klickfläche von „Entfernen“ minimal größer (besseres Tap-Ziel) */
    .btn-link { padding: 8px 4px; }

    /* 4) Falls du die Preis-Spalte breiter willst (lange Beträge) */
    :root { --price-col: 150px; }

    /*5) Klare Tastatur-Fokussierung für Links in den Items */
    .name a:focus-visible, .btn-link:focus-visible {
    outline: 3px solid #000; outline-offset: 2px; border-radius: 6px;
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>Meine Wunschliste</h1>

    <h2 class="section-title">Neu hinzufügen</h2>
    <form id="form">
      <div class="field field--name">
        <label for="name">Name</label>
        <input id="name" name="name" type="text" placeholder="z. B. Kopfhörer" required />
      </div>

      <div class="field field--price">
        <label for="price">Preis (EUR)</label>
        <input id="price" name="price" type="text" inputmode="decimal" placeholder="z. B. 49,99" required />
      </div>

      <div class="field field--url">
        <label for="url">Link (optional)</label>
        <input id="url" name="url" type="url" placeholder="https://…" />
      </div>

      <div class="field field--add">
        <button type="submit" id="addBtn" class="btn btn-primary">Hinzufügen</button>
      </div>
    </form>

    <div class="toolbar">
      <button id="clearBtn" class="btn btn-link" title="Alle Einträge löschen">Alles löschen</button>
      <button id="exportBtn" class="btn btn-link" title="Als Datei exportieren">Exportieren</button>
      <input type="file" id="importFile" accept="application/json" style="display:none" />
      <button id="importBtn" class="btn btn-link" title="Aus Datei importieren">Importieren</button>
    </div>

    <h2 class="section-title">Liste</h2>
    <div class="list-head">
      <div>Artikel</div>
      <div class="price">Preis</div>
      <div class="actions">Aktion</div>
    </div>

    <ul id="list"></ul>

    <div id="summary" class="summary" style="display:none">
      <div class="label">Gesamt</div>
      <div id="total" class="price">0,00 €</div>
      <div class="actions"></div> <!-- leer, hält die 3. Spalte -->
    </div>
  </div>

  <script>
    const STORAGE_KEY = 'wishlistItems.v1';
    let items = loadItems();

    const form = document.getElementById('form');
    const nameEl = document.getElementById('name');
    const priceEl = document.getElementById('price');
    const urlEl = document.getElementById('url');
    const listEl = document.getElementById('list');
    const totalEl = document.getElementById('total');
    const summaryEl = document.getElementById('summary');
    const clearBtn = document.getElementById('clearBtn');
    const exportBtn = document.getElementById('exportBtn');
    const importBtn = document.getElementById('importBtn');
    const importFile = document.getElementById('importFile');

    const fmt = new Intl.NumberFormat('de-DE', { style: 'currency', currency: 'EUR' });

    function loadItems() {
      try {
        const raw = localStorage.getItem(STORAGE_KEY);
        if (!raw) return [];
        const data = JSON.parse(raw);
        if (Array.isArray(data)) return data;
      } catch {}
      return [];
    }
    function saveItems() {
      localStorage.setItem(STORAGE_KEY, JSON.stringify(items));
    }
    function normalizeUrl(u) {
      if (!u) return '';
      let s = u.trim();
      if (!s) return '';
      if (!/^https?:\/\//i.test(s)) s = 'https://' + s;
      return s;
    }
    function parsePrice(value) {
      // Akzeptiert "1.234,56" oder "1234.56"
      const normalized = value.trim().replace(/\./g, '').replace(',', '.');
      const num = Number.parseFloat(normalized);
      return Number.isFinite(num) ? num : NaN;
    }

    function addItem(ev) {
      ev.preventDefault();
      const name = nameEl.value.trim();
      const priceStr = priceEl.value;
      const link = normalizeUrl(urlEl.value);

      if (!name) { alert('Bitte einen Namen eingeben.'); nameEl.focus(); return; }
      const price = parsePrice(priceStr);
      if (!Number.isFinite(price) || price < 0) { alert('Bitte einen gültigen Preis eingeben (z. B. 49,99).'); priceEl.focus(); return; }

      const item = { id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random()), name, price, link };
      items.push(item);
      saveItems();
      render();

      form.reset();
      nameEl.focus();
    }

    function deleteItem(id) {
      items = items.filter(it => it.id !== id);
      saveItems();
      render();
    }

    function clearAll() {
      if (items.length === 0) return;
      if (!confirm('Wirklich alle Einträge löschen?')) return;
      items = [];
      saveItems();
      render();
    }

    function render() {
      listEl.innerHTML = '';
      if (items.length === 0) {
        const li = document.createElement('li');
        li.className = 'empty';
        li.textContent = 'Noch keine Einträge – füge oben etwas hinzu.';
        listEl.appendChild(li);
        summaryEl.style.display = 'none';
        return;
      }

      let total = 0;

      items.forEach(it => {
        total += it.price;

        const li = document.createElement('li');
        li.className = 'item';

        const nameDiv = document.createElement('div');
        nameDiv.className = 'name';
        if (it.link) {
          const a = document.createElement('a');
          a.href = it.link;
          a.target = '_blank';
          a.rel = 'noopener noreferrer';
          a.textContent = it.name;
          nameDiv.appendChild(a);
        } else {
          const span = document.createElement('span');
          span.textContent = it.name;
          nameDiv.appendChild(span);
        }

        const priceDiv = document.createElement('div');
        priceDiv.className = 'price';
        priceDiv.textContent = fmt.format(it.price);

        const actionsDiv = document.createElement('div');
        actionsDiv.className = 'row-actions';
        const delBtn = document.createElement('button');
        delBtn.type = 'button';
        delBtn.className = 'btn btn-link';
        delBtn.textContent = 'Entfernen';
        delBtn.setAttribute('aria-label', 'Eintrag entfernen: ' + it.name);
        delBtn.addEventListener('click', () => deleteItem(it.id));
        actionsDiv.appendChild(delBtn);

        li.appendChild(nameDiv);
        li.appendChild(priceDiv);
        li.appendChild(actionsDiv);

        listEl.appendChild(li);
      });

      totalEl.textContent = fmt.format(total);
      summaryEl.style.display = 'grid';
    }

    function exportItems() {
      const blob = new Blob([JSON.stringify(items, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'wunschliste.json';
      document.body.appendChild(a);
      a.click();
      setTimeout(() => {
        URL.revokeObjectURL(url);
        a.remove();
      }, 0);
    }

    function importItems() {
      importFile.click();
    }

    importFile.addEventListener('change', async (e) => {
      const file = e.target.files?.[0];
      if (!file) return;
      try {
        const text = await file.text();
        const data = JSON.parse(text);
        if (!Array.isArray(data)) throw new Error('Ungültiges Format');
        const cleaned = data.map(x => ({
          id: x.id || String(Date.now() + Math.random()),
          name: String(x.name || '').trim(),
          price: Number(x.price) || 0,
          link: normalizeUrl(String(x.link || ''))
        })).filter(x => x.name);
        items = cleaned;
        saveItems();
        render();
      } catch (err) {
        alert('Import fehlgeschlagen: ' + (err?.message || 'Unbekannter Fehler'));
      } finally {
        importFile.value = '';
      }
    });

    exportBtn.addEventListener('click', exportItems);
    importBtn.addEventListener('click', importItems);
    clearBtn.addEventListener('click', clearAll);
    form.addEventListener('submit', addItem);

    render();
  </script>
</body>
</html>